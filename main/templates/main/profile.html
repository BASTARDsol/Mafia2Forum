{% extends 'main/base.html' %}
{% load static %}

{% block content %}
<style>
.profile-hero { background: linear-gradient(120deg,#1a1a1f,#292931); border:1px solid #3a3420; border-radius:16px; padding:24px; margin-bottom:20px; }
.profile-main { display:flex; gap:20px; flex-wrap:wrap; }
.profile-avatar-wrap { text-align:center; width:220px; }
.profile-avatar-lg { width:170px; height:170px; border-radius:50%; border:3px solid #d4af37; object-fit:cover; }
.profile-name { margin:0; font-size:30px; }
.status-pill { display:inline-block; margin-top:8px; padding:5px 12px; border-radius:999px; font-size:12px; }
.status-online { background:#1f4d2e; color:#9cf7b8; }
.status-offline { background:#3d2f1f; color:#e4c47d; }
.profile-stats-grid { display:grid; grid-template-columns:repeat(2,minmax(160px,1fr)); gap:12px; margin-top:14px; }
.stat-item { background:#121218; border:1px solid #3a3420; border-radius:12px; padding:12px; }
.stat-label { color:#9d926f; font-size:12px; }
.stat-value { font-size:24px; font-weight:700; }
.profile-panels { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.profile-list-card { background:#19191f; border:1px solid #2f2f36; border-radius:14px; padding:16px; }
.profile-list-card h3 { margin-top:0; }
.profile-list { margin:0; padding-left:18px; }

.cover-wrap { height: 180px; border-radius: 14px; margin-bottom: 14px; overflow:hidden; border:1px solid #3a3420; }
.cover-wrap img { width:100%; height:100%; object-fit:cover; }
@media (max-width: 900px){ .profile-panels { grid-template-columns:1fr; } }
</style>

<div class="profile-hero">
  <div class="cover-wrap">
    {% if user_obj.profile.cover_image %}<img src="{{ user_obj.profile.cover_image.url }}" alt="cover">{% else %}<img src="{% static 'images/avatar4.png' %}" alt="cover">{% endif %}
  </div>
  <div class="profile-main">
    <div class="profile-avatar-wrap">
      {% if user_obj.profile.avatar %}
        <img src="{{ user_obj.profile.avatar.url }}" class="profile-avatar-lg" alt="">
      {% else %}
        <img src="{% static user_obj.profile.default_avatar %}" class="profile-avatar-lg" alt="">
      {% endif %}
      {% if is_own_profile %}
        <div style="margin-top:14px; display:grid; gap:8px;">
          <a href="{% url 'profile_edit' %}" class="header-btn">Редактировать</a>
        </div>
      {% elif user.is_authenticated %}
        <div style="margin-top:14px;">
          <form method="post" action="{% url 'dialog-start' user_obj.username %}">{% csrf_token %}<button type="submit">Написать в ЛС</button></form>
        </div>
      {% endif %}
    </div>

    <div style="flex:1; min-width:280px;">
      <h2 class="profile-name">{{ user_obj.username }}</h2>
      <p style="margin:4px 0 0; color:#afafaf;">На форуме с {{ user_obj.date_joined|date:"d M Y" }}</p>
      {% if is_online %}
        <span class="status-pill status-online">● В сети</span>
      {% else %}
        <span class="status-pill status-offline">◔ Был недавно</span>
      {% endif %}

      <div class="profile-stats-grid">
        <div class="stat-item"><div class="stat-label">Темы</div><div class="stat-value">{{ stats.topics_count }}</div></div>
        <div class="stat-item"><div class="stat-label">Посты</div><div class="stat-value">{{ stats.posts_count }}</div></div>
        <div class="stat-item"><div class="stat-label">Комментарии</div><div class="stat-value">{{ stats.comments_count }}</div></div>
        <div class="stat-item"><div class="stat-label">Получено лайков</div><div class="stat-value">{{ stats.received_topic_likes|add:stats.received_post_likes }}</div></div>
      </div>
          <div style="margin-top:12px; color:#d6d6d6; line-height:1.5;">{{ user_obj.profile.bio|default:"О себе пока ничего не написал(а)." }}</div>
    </div>
  </div>
</div>

<div class="profile-panels">
  <div class="profile-list-card">
    <h3>Последние темы</h3>
    <ul class="profile-list">
      {% for topic in recent_topics %}
        <li><a href="{% url 'topic-detail' topic.id %}">{{ topic.title }}</a> <span style="color:#888;">· {{ topic.created_at|date:"d.m H:i" }}</span></li>
      {% empty %}
        <li style="color:#999;">Тем пока нет.</li>
      {% endfor %}
    </ul>
  </div>
  <div class="profile-list-card">
    <h3>Последние посты</h3>
    <ul class="profile-list">
      {% for post in recent_posts %}
        <li><a href="{% url 'topic-detail' post.topic.id %}">{{ post.topic.title }}</a> <span style="color:#888;">· {{ post.created_at|date:"d.m H:i" }}</span></li>
      {% empty %}
        <li style="color:#999;">Постов пока нет.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
